# 題組三解題步驟

## 步驟一：將素材目錄複製到崗位目錄下，確認素材內容與抽題題號一致
監評長按下倒數計時後，可以先把桌面上素材目錄中的題目素材複製一份到自己的工作目錄下，這時要確認自己複製的題目和抽到的題目是一致的，之後都在工作目錄下來取用相關的素材，這樣比較不容易出錯；在安裝軟體的準備時間裏，也要確認一下電腦桌面中是否有包含了素材這個目錄，並且四個題組的素材都在其中。

---

## 步驟二：將版型檔案及相關素材複製到網站根目錄下，並進行相應的更名及整理
  1. 開立./css, ./js, ./api, ./icon等常用目錄以利檔案分類及管理
  2. 將素材檔中的.css, .js, 及icon圖檔複製到相應的目錄下
  3. 更改版型素材的相關檔名，以符合解題的需要：
      * 03P01.htm => index.php
      * 03P02.htm => intro.php
      * 03P03.htm => admin.php
  4. 更改版型素材的相關連結及匯入檔內容
      * 修改 `index.php` 中 `<link>` 及 `<script>` 中的連結路徑，指向正確的位置
      * 修改 `./css/css.css` 中的圖片 `url` ，指向根目錄下的 `../icon` 目錄，不過在此題組中，body設定中的 `b.png` 圖檔不存在，所以直接移除這個設定就可以了。
        ```
        body{
            background:url(../icon/b.png); /* 移除這行即可 */
	        font-family:微軟正黑體;
        }
        ```
  5. 開立 `./movie/` 目錄，把素材目錄中的院線片海報及影片檔都先複製過來
  6. 開立 `./poster/` 目錄，把素材目錄中的預告片海報都先複製過來
  7. 以上兩個步驟是為了方便之後在製作列表和上傳檔案功能時，可以減少一些功夫，同時我們為了速度考量，並不會對上傳的檔案做更名之類的多餘動作，因此我們在做列表功能時，可以直接指定目錄及檔名來顯示相關的圖片或影片，而不用等到完成上傳檔案的功能後，才一個一個上傳
  8. 開啟 `xampp` 及 `apache` 伺服器，使用 `localhost` 或 `127.0.0.1` 檢視網頁是否正確顯示，css 的載入是否正確

---

## 步驟三：進行前後台的檔案整理及切版，分離出共用的區塊或功能
  1. 建立 `front`及 `admin` 兩個目錄，一個代表前台的相關檔案，一個代表後台的相關檔案，前後台共用的元件則先放在根目錄下，或另開一個 `comm` 目錄用來存放共用的元件。
  2. 在 `index.php` 中找到中間主要內容區的區塊，切出去成為 `home.php` 放在 `./front/` 目錄中。
  3. 在 `intro.php` 中找到中間主要內容區的區塊，排除首尾後成為 `intro.php` 移動到 `./front/` 目錄中。
  4. 在 `admin.php` 中找到中間主要內容區的區塊，保留後台選單的部份，其它的內容切出去成為 `home.php` 放在 `/admin/` 目錄中，不過因為這個 `home.php` 只有一行的內容，所以也可以用 `echo` 的方式寫死在 `admin.php` 中。

```php
//另一個做法參考，省略home.php
  $do=(!empty($_GET['do']))?$_GET['do']:"";
  $path="./admin/".$do.".php";
  if(file_exists($path)){
    include $path;
  }else{
    echo "<h2 class='ct'>請選擇所需功能</h2>";
  }
```

  5. 使用 `include` 指令來重新組合 `index.php` 及 `admin.php` 頁面，並加上判斷式來確保要組合的檔案是存在的。
  6. 以 `get` 的方式來傳遞各頁面要組合的元件內容，比如 `do=login` 表示要看到的是登入頁面，因此在前台的 `include` 中可以併入 `login.php` 來呈現。
  7. 修改 `index.php` 及 `admin.php` 中的連結內容及寫法，確保可以正確的連結到相應的頁面。
  8. 修改 `admin.php` 中的後台功能連結內容，後續的功能會用到。

---

## 步驟四：建立資料庫連線檔及常用函式。
  1. 建立 `base.php` 檔，用來放共用的設定及函式。
  2. 設定好PDO的連線參數 `$pdo=new PDO()`
  3. 啟用session `session_start()`
  4. 建立全域變數或是共用函式
      * find(\$table,...\$arg) - 尋找特定條件的單筆資料或第一筆資料
      * all(\$table,...\$arg) - 取得資料表的全部資料或是特定條件的全部資料
      * nums(\$table,...\$arg) - 計算符合條件的資料筆數
      * save(\$talbe,\$data) - 新增或更新單筆資料
      * del(\$table,...\$arg) - 刪除特定條件的全部資料
      * q(\$sql) - 簡化 \$pdo->query(\$sql)->fetchAll() 的使用;
      * to(\$path) - 簡化 header("location:xxxxxx") 的使用;
  5. 做好以上工作後，可以先建一張簡單的資料表，把資料庫連線及所有自訂函式功能先測試一次，以確保後續使用不會有問題。

---

## 步驟五：建立資料表及預設資料。
每個題組依狀況不同，在這一步有不同的做法，視自己對題目的熟悉程度來做應變，可以一次把全部資料表建完，也可以視解題的進度來逐步建立或修改資料表。
根據題意，題組三會需要用到以下的資料表：
* movie - 院線片資料表
* ord - 訂單資料表
* poster - 預告片資料表

1. 依序建立功能需要的三張資料表:
  * movie

    |   name   |    type    |  pk   | default |  A_I  |   note   |
    | :------: | :--------: | :---: | :-----: | :---: | :------: |
    |    id    |  int(10)   |  yes  |         |  yes  | 流 水 號 |
    |   name   |    text    |       |         |       | 電影名稱 |
    |  level   | tinyint(1) |       |         |       |   分級   |
    |  length  |   int(5)   |       |         |       |   長度   |
    |  ondate  |    date    |       |         |       | 放映日期 |
    | publish  |    text    |       |         |       |  發行商  |
    | director |    text    |       |         |       |   導演   |
    | trailer  |    text    |       |         |       | 預告影片 |
    |  poster  |    text    |       |         |       | 預告海報 |
    |  intro   |    text    |       |         |       | 電影介紹 |
    |   rank   |   int(5)   |       |         |       |   排序   |
    |    sh    |   int(1)   |       |    1    |       |   顯示   |
    
  * ord

    |  name   |  type   |  pk   | default |  A_I  |   note   |
    | :-----: | :-----: | :---: | :-----: | :---: | :------: |
    |   id    | int(10) |  yes  |         |  yes  |  流水號  |
    |   no    |  text   |       |         |       | 訂單編號 |
    |  movie  |  text   |       |         |       | 電影名稱 |
    |  date   |  date   |       |         |       | 觀影日期 |
    | session |  text   |       |         |       |   場次   |
    |   qt    | int(1)  |       |         |       |   票數   |
    |  seat   |  text   |       |         |       |   座位   |

  * poster
  
    |  name  |  type   |  pk   | default |  A_I  |   note   |
    | :----: | :-----: | :---: | :-----: | :---: | :------: |
    |   id   | int(10) |  yes  |         |  yes  |  流水號  |
    | poster |  text   |       |         |       | 檔案路徑 |
    |  name  |  text   |       |         |       |   片名   |
    |  rank  | int(5)  |       |         |       |   排序   |
    |   sh   | int(1)  |       |    1    |       |   顯示   |
    |  ani   | int(1)  |       |    1    |       | 轉場動畫 |

2. 為了解題順利，可以把資料表中的一些欄位設為可接受空值的狀況，這樣即使未設定內容，也能正常新增或更改資料，不過這個做法只是為了先求解題完成而做的取巧，實務上應該根據需求及功能來決定欄位是否可以接受空值，並在程式端檢查來源資料是否為空值

---

## 步驟六：管理登入
題組三的管理登入算是簡單的功能，並不需要有個管理者的資料表來做紀錄，因此這邊只要直接寫死帳密做檢查即可；另外，雖然題目中沒有提到，但為了避免每次要到後台時都要再一次輸入帳號密碼，這邊建議還是建一個session變數來紀錄登入的狀態：
1. 在 `admin.php` 撰寫以session為判斷的登入程式，如果己經登入則可以選擇後台功能，如果未登入，則顯示登入表單。
2. 因為會使用到session，所以記得要先在 `admin.php` 的最前面 include `base.php` 來啟用session的功能
3. 撰寫登入判斷程式，帳號依題意寫死即可(帳號:admin,密碼:1234)
4. 這邊要注意的是在未登入的狀況下，只顯示登入表單而己，後台的功能選單在未登入時是不顯示的。
5. 由於素材提供的版型配色和字型等內容與題目的示意圖落差極大，因此題組三我們不太管示意圖的視覺配置了，只要功能符合就可以。
6. 修改 `admin.php` 中的內容區域寬度，方便後續的程式撰寫
```html
    <div class="rb tab" style="width:98%">
      <!---功能內容----->
    </div>
```
7. 這邊要小心判斷式中包含的html區段，避免漏了tag沒包到造成版面出錯